---
title: "ADAM: Activity and Diversity Analysis Module"
author: >
  Andre L. Molan, Giordano B. S. Seco, Agnes A. S. Takeda,
  Jose L. Rybarczyk-Filho
date: "`r doc_date()`"
package: "`r pkg_ver('ADAM')`"
bibliography: bibliography.bib
fig_caption: yes
output:
    BiocStyle::html_document:
        css: custom.css
vignette: >
    %\VignetteIndexEntry{"ADAM"}
    %\VignetteEngine{knitr::rmarkdown}
    %\VignetteEncoding{UTF-8}
---

# Overview

*ADAM* performs gene set enrichment analysis by grouping genes from comparative
samples (control versus experiment) according to functional groups (GFAGs), and
quantifies both diversity and activity signals for each group (@Castro2009).

The package now provides a Bioconductor-oriented interface, `run_adam()`, which
is the recommended entry point for new analyses. It supports:

- legacy `data.frame` or file inputs
- `SummarizedExperiment`
- `SingleCellExperiment`
- `ExpressionSet`

This vignette focuses on `run_adam()` first, and keeps legacy APIs in a
compatibility section.

```{r setup, eval=TRUE}
suppressMessages(library(ADAM))
data("ExpressionAedes")
data("KeggPathwaysAedes")
```

# Recommended workflow: `run_adam()`

## 1) Partial mode with legacy table input

```{r run-adam-partial-table, eval=TRUE}
res_partial <- suppressMessages(run_adam(
  x = ExpressionAedes,
  mode = "partial",
  comparison_id = c("control1,experiment1", "control2,experiment2"),
  MinGene = 3L,
  MaxGene = 20L,
  DBSpecies = KeggPathwaysAedes,
  AnalysisDomain = "own",
  GeneIdentifier = "geneStableID"
))

res_partial
head(as.data.frame(SummarizedExperiment::rowData(res_partial)))
```

`run_adam()` returns a `SummarizedExperiment` with:

- `assay("metrics")`: numeric analysis metrics
- `rowData()`: GFAG annotations and per-comparison fields
- `metadata()`: legacy result, gene-function map, comparison IDs, and mode

```{r run-adam-partial-inspect, eval=TRUE}
colnames(SummarizedExperiment::assay(res_partial, "metrics"))
head(S4Vectors::metadata(res_partial)$comparison_id)
```

## 2) Complete mode (bootstrap-based significance)

```{r run-adam-complete, eval=TRUE}
res_complete <- suppressMessages(run_adam(
  x = ExpressionAedes,
  mode = "complete",
  comparison_id = c("control1,experiment1"),
  MinGene = 3L,
  MaxGene = 20L,
  SeedNumber = 1049,
  BootstrapNumber = 50L,
  PCorrection = 0.05,
  PCorrectionMethod = "fdr",
  WilcoxonTest = FALSE,
  FisherTest = FALSE,
  DBSpecies = KeggPathwaysAedes,
  AnalysisDomain = "own",
  GeneIdentifier = "geneStableID"
))

res_complete
head(as.data.frame(SummarizedExperiment::rowData(res_complete)))
```

# Bioconductor container example (`SummarizedExperiment`)

```{r run-adam-se, eval=TRUE}
expr <- as.matrix(ExpressionAedes[, -1])
rownames(expr) <- as.character(ExpressionAedes$gene)

col_data <- S4Vectors::DataFrame(
  condition = c("control", "experiment", "control", "experiment"),
  row.names = colnames(expr)
)

se <- SummarizedExperiment::SummarizedExperiment(
  assays = list(counts = expr),
  colData = col_data
)

res_se <- suppressMessages(run_adam(
  x = se,
  mode = "partial",
  assay_name = "counts",
  group_col = "condition",
  contrast = c("control", "experiment"),
  DBSpecies = KeggPathwaysAedes,
  AnalysisDomain = "own",
  GeneIdentifier = "geneStableID"
))

res_se
head(as.data.frame(SummarizedExperiment::rowData(res_se)))
```

# Legacy APIs (compatibility)

The legacy APIs remain available:

- `ADAnalysis()` for partial analysis
- `GFAGAnalysis()` for complete analysis

They return the original list structure (`gene-function map`,
`comparison result tables`). `run_adam()` wraps these APIs and converts their
output to `SummarizedExperiment` for easier Bioconductor interoperability.

```{r legacy-compatibility, eval=TRUE}
legacy_partial <- suppressMessages(ADAnalysis(
  ComparisonID = c("control1,experiment1"),
  ExpressionData = ExpressionAedes,
  MinGene = 3L,
  MaxGene = 20L,
  DBSpecies = KeggPathwaysAedes,
  AnalysisDomain = "own",
  GeneIdentifier = "geneStableID"
))

length(legacy_partial)
head(legacy_partial[[1]])
```

# Reproducibility

- Use fixed `SeedNumber` and `BootstrapNumber` for `mode = "complete"`.
- Keep `DBSpecies`, `AnalysisDomain`, and `GeneIdentifier` consistent across
  comparative runs.
- Save outputs as `.rds` and include `sessionInfo()` in reports.

```{r session-info, eval=FALSE}
sessionInfo()
```
